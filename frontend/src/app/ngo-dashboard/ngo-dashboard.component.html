<div class="dashboard-page fade-page">

  <!-- HEADER -->
  <div class="dashboard-header">
    <div>
      <h2>NGO Dashboard</h2>
      <p class="subtitle">Manage donation requests and track pickup status</p>
    </div>

    <div class="header-actions">
      <button class="create-btn" (click)="createDonation()">+ Create Donation</button>
      <button class="logout-btn" (click)="logout()">Logout</button>
    </div>
  </div>

  <!-- STATS -->
  <div class="stats-container">
    <div class="stat-card total">
      <h3>Total Requests</h3>
      <p>{{ animatedStats.total }}</p>
    </div>

    <div class="stat-card pending">
      <h3>Pending / Confirmed</h3>
      <p>{{ animatedStats.pending }}</p>
    </div>

    <div class="stat-card completed">
      <h3>Completed</h3>
      <p>{{ animatedStats.completed }}</p>
    </div>
  </div>

  <!-- CHART -->
  <div class="chart-container">
    <h3>Request Status Overview</h3>
    <canvas id="ngoChart"></canvas>
    <p class="hint">Click chart to filter table</p>
  </div>

  <!-- TABLE -->
  <div class="table-container">
    <h3 class="section-title">Donation Requests</h3>

    <table *ngIf="!loading && filteredDonations.length > 0">
      <thead>
        <tr>
          <th>Type</th>
          <th>Quantity</th>
          <th>Location</th>
          <th>Pickup Date</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let d of filteredDonations">
          <td>{{ d.donation_type }}</td>
          <td>{{ d.quantity_or_amount }}</td>
          <td>{{ d.location }}</td>
          <td>{{ d.pickup_date_time | date:'mediumDate' }}</td>

          <!-- STATUS -->
          <td>
            <span
              class="status-badge"
              [ngClass]="{
                pending: d.status === 'PENDING' || d.status === 'CONFIRMED',
                completed: d.status === 'COMPLETED',
                expired: d.status === 'EXPIRED'
              }"
            >
              {{ d.status }}
            </span>
          </td>

          <!-- ACTION -->
          <td>
            <!-- Confirmed -->
            <button
              *ngIf="d.status === 'CONFIRMED'"
              class="complete-btn"
              (click)="markCompleted(d.id)"
            >
              Mark Completed
            </button>

            <!-- Completed -->
            <span *ngIf="d.status === 'COMPLETED'" class="completed-text">
              ✔ Done
            </span>

            <!-- Expired -->
            <span *ngIf="d.status === 'EXPIRED'" class="expired-text">
              ⛔ Expired (Pickup time passed)
            </span>
          </td>
        </tr>
      </tbody>
    </table>

    <p class="empty" *ngIf="!loading && filteredDonations.length === 0">
      No matching donation requests
    </p>
  </div>

</div>